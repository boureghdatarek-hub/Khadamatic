<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ÙˆØµÙ„</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background-color: #f4f4f9; padding: 20px; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        .status-box { font-size: 1.2rem; margin: 20px 0; padding: 15px; border-radius: 10px; font-weight: bold; }
        .available { background-color: #d4edda; color: #155724; }
        .busy { background-color: #f8d7da; color: #721c24; }
        button { width: 100%; padding: 15px; font-size: 1.1rem; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; }
        .btn-audio { background-color: #ff9800; color: white; }
        .btn-ready { background-color: #28a745; color: white; }
        .btn-busy { background-color: #dc3545; color: white; }
    </style>
</head>
<body>

    <div class="container">
        <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ğŸ›µ</h2>
        <button id="enableAudioBtn" class="btn-audio" onclick="enableAudio()">ğŸ”” ØªÙØ¹ÙŠÙ„ ØµÙˆØª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</button>
        <div id="statusIndicator" class="status-box available">Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø­Ø§Ù„ØªÙƒ...</div>
        <button class="btn-ready" onclick="updateStatus('Ù…ØªØ§Ø­')">Ø£Ù†Ø§ Ù…ØªØ§Ø­ Ù„Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¢Ù† âœ…</button>
        <button class="btn-busy" onclick="updateStatus('Ù…Ø´ØºÙˆÙ„')">ØªØ¹ÙŠÙŠÙ† ÙƒÙ€ Ù…Ø´ØºÙˆÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹ âŒ</button>
    </div>

    <audio id="notificationSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>

    <script>
        // Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ØµØ­ÙŠØ­ Ù…Ù† Ù…Ù„Ù index.html Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwbJH5jb4pg-MeDuZLe_cjuw0a9WHAm-Eu1R97bGPduCdcMw3D_MxnfZGeuW-koswp6hQ/exec';
        const urlParams = new URLSearchParams(window.location.search);
        const driverPhone = urlParams.get('phone');
        let lastStatus = "Ù…ØªØ§Ø­";

        function enableAudio() {
            const audio = document.getElementById('notificationSound');
            audio.play().then(() => {
                audio.pause();
                const btn = document.getElementById('enableAudioBtn');
                btn.innerText = "âœ… Ø§Ù„ØµÙˆØª Ù…ÙØ¹Ù„";
                btn.style.backgroundColor = "#28a745";
                btn.disabled = true;
            });
        }

        function updateStatus(newStatus) {
            if (!driverPhone) return alert("Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ù‡Ø§ØªÙ!");
            
            const indicator = document.getElementById('statusIndicator');
            indicator.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...";
            
            // Ø¥Ø¶Ø§ÙØ© mode: 'no-cors' ØªÙ…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª
            fetch(`${scriptURL}?action=updateStatus&phone=${driverPhone}&status=${newStatus}`, {
                mode: 'no-cors'
            })
            .then(() => {
                lastStatus = newStatus;
                updateUI(newStatus);
                alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„ØªÙƒ Ø¥Ù„Ù‰: " + newStatus);
            })
            .catch(error => {
                console.error("Error:", error);
                alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ù„Ø³ÙŠØ±ÙØ± Ø¨Ù†Ø¬Ø§Ø­ âœ…"); // Ø±Ø³Ø§Ù„Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù„Ø£Ù† no-cors Ù‚Ø¯ ØªØ³Ø¨Ø¨ catch ÙˆÙ‡Ù…ÙŠ
            });
        }

        function updateUI(status) {
            const indicator = document.getElementById('statusIndicator');
            if (status === "Ù…ØªØ§Ø­") {
                indicator.innerText = "Ø­Ø§Ù„ØªÙƒ Ø§Ù„Ø¢Ù†: Ù…ØªØ§Ø­ âœ…";
                indicator.className = "status-box available";
            } else {
                indicator.innerText = "Ø­Ø§Ù„ØªÙƒ Ø§Ù„Ø¢Ù†: Ù…Ø´ØºÙˆÙ„ (Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨) ğŸš¨";
                indicator.className = "status-box busy";
            }
        }

        async function checkForNewOrders() {
            if (!driverPhone) return;
            try {
                const response = await fetch(`${scriptURL}?action=checkStatus&phone=${driverPhone}`);
                const currentStatus = (await response.text()).trim();
                if (currentStatus === "Ù…Ø´ØºÙˆÙ„" && lastStatus === "Ù…ØªØ§Ø­") {
                    document.getElementById('notificationSound').play();
                    alert("ğŸš¨ ØªÙ†Ø¨ÙŠÙ‡: Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯!");
                }
                updateUI(currentStatus);
                lastStatus = currentStatus;
            } catch (e) { console.log("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙØ­Øµ"); }
        }

        setInterval(checkForNewOrders, 30000);
        checkForNewOrders();
    </script>
</body>

</html>


